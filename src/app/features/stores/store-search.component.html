<form class="search-form" (ngSubmit)="onSearch()">
  <input type="text" [(ngModel)]="city" name="city" placeholder="City (e.g., San Francisco)"/>
  <input type="text" [(ngModel)]="zip" name="zip" placeholder="ZIP (e.g., 94110)"/>
  <button type="submit" class="search-btn">Search</button>
  <button type="button" class="search-btn" (click)="useMyLocation()">Use my location</button>
</form>

<div *ngIf="stores && stores.length === 0" class="muted">No stores found.</div>

<ul class="store-list">
  <li *ngFor="let s of stores" (click)="loadSpots(s)" class="store">
    <div class="store-header">
      <div class="title">{{ s.name }}</div>

      <!-- Right-aligned rating + review button -->
      <div class="store-rating">
        <div class="stars">
          <ng-container *ngIf="s.averageRating !== undefined">
            <span class="star">&#9733;</span> {{ s.averageRating | number:'1.1-1' }}
          </ng-container>
          <ng-container *ngIf="s.reviewCount !== undefined">
            ({{ s.reviewCount }})
          </ng-container>
        </div>
        <button type="button" (click)="toggleReviews(s); $event.stopPropagation()" class="view-reviews-btn">
          {{ s.showReviews ? 'Hide Reviews' : 'View Reviews' }}
        </button>
      </div>
    </div>



    <!-- Review component for this store -->
    <div *ngIf="s.showReviews">
      <app-review
        [targetType]="'STORE'"
        [targetId]="s.id">
      </app-review>
    </div>

    <div *ngIf="spots[s.id]" class="spots" (click)="$event.stopPropagation()">
      <div *ngFor="let sp of spots[s.id]" class="spot">
        <div class="card-header">Spot</div>
        <span>${{ sp.pricePerDay }}/day</span>
        <span [class.bad]="!sp.available">{{ sp.available ? 'Available' : 'Unavailable' }}</span>
        <button (click)="book(s.id, sp.id)" [disabled]="!sp.available">Book</button>
      </div>
    </div>
  </li>
</ul>
